# Пример надстройки Word с выносками изображений: загрузка, редактирование и вставка изображений

**Содержание**

* [Сводка](#summary)
* [Необходимые средства](#required-tools)
* [Как устанавливать сертификаты](#how-to-install-certificates)
* [Как установить и запустить приложение](#how-to-set-up-and-run-the-app)
* [Как запустить надстройку в Word 2016 для Windows](#how-to-run-the-add-in-in-Word-2016-for-Windows)
* [Вопросы и ответы](#faq)
* [Вопросы и комментарии](#questions-and-comments)
* [Подробнее](#learn-more)


## Сводка

В этом примере надстройки Word показано, как:

1. создать надстройку Word с помощью Typescript;
2. загружать изображения из документа в надстройку;
3. редактировать изображения в надстройке с помощью API холста HTML и вставлять изображения в документ Word;
4. реализовать команды надстройки, которые как запускают надстройку с ленты, так и выполняют скрипт с ленты и из контекстного меню;
5. оформить надстройку в стиле Word с помощью Office UI Fabric.

![](/readme-images/Word-Add-in-TypeScript-Canvas.gif)

Определение. **Команда надстройки** — это расширение пользовательского интерфейса Word, позволяющее запустить надстройку в области задач либо выполнить скрипт, выбрав его на ленте или в контекстном меню.

Если вы просто хотите увидеть ее в действии, перейдите к разделу [Установка Word 2016 для Windows](#word-2016-for-windows-set-up) и используйте этот [манифест](https://github.com/OfficeDev/Word-Add-in-TypeScript-Canvas/blob/deploy2Azure/manifest-word-add-in-canvas.xml).

## Необходимые средства

Чтобы использовать пример надстройки Word с выносками изображений, необходимо следующее:

* Word 2016 16.0.6326.0000 или более поздней версии либо другой клиент, поддерживающий API JavaScript для Word. В этом примере выполняется проверка требований, чтобы определить, запущена ли надстройка в ведущем приложении, поддерживающем API-интерфейсы JavaScript.
* Используйте npm (https://www.npmjs.com/) для установки зависимостей. Он поставляется вместе с [NodeJS](https://nodejs.org/en/).
* (Windows) [Git Bash](http://www.git-scm.com/downloads).
* Клонируйте этот репозиторий на локальный компьютер.

> Примечание. В настоящее время Word для Mac 2016 не поддерживает команды надстроек. Этот пример можно запустить на компьютере Mac без команд надстройки.

## Как устанавливать сертификаты

Для работы этого примера потребуется сертификат, так как команды надстроек используют протокол HTTPS. У них нет интерфейса, поэтому принимать недействительные сертификаты невозможно. Запустите [./gen-cert.sh](#gen-cert.sh), чтобы создать сертификат. Затем вам потребуется установить файл ca.crt в хранилище доверенных корневых центров сертификации (Windows).

## Как установить и запустить приложение

1. Установите диспетчер определений TypeScript, введя команду ```npm install typings -g``` в командной строке.
2. Установите определения Typescript из файла typings.json, выполнив команду ```typings install``` в корневом каталоге проекта.
3. Установите зависимости проекта, определенные в файле package.json, выполнив команду ```npm install``` в корневом каталоге проекта.
4. Установите gulp: ```npm install -g gulp```.
5. Скопируйте файлы Fabric и JQuery с помощью команды ```gulp copy:libs```. Если с этим возникнут проблемы, убедитесь, что переменная пути содержит значение *%APPDATA%\npm* (для Windows).
6. Запустите задачу gulp по умолчанию, выполнив команду ```gulp``` в корневом каталоге проекта. Если определения TypeScript не обновлены, возникнет ошибка.

Вы только что развернули пример надстройки. Теперь необходимо сообщить Word, где находится эта надстройка.

### Установка Word 2016 для Windows

1. Распакуйте и установите этот [ключ реестра](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/tree/master/Tools/AddInCommandsUndark), чтобы активировать команды надстроек (только для Windows). Это обязательно, пока команды надстроек находятся в **предварительной версии**.
2. Создайте сетевую папку или [откройте доступ к папке в сети](https://technet.microsoft.com/ru-ru/library/cc770880.aspx) и поместите в нее файл манифеста [manifest-word-add-in-canvas.xml](manifest-word-add-in-canvas.xml).
3. Запустите Word и откройте документ.
4. Перейдите на вкладку **Файл**, а затем выберите **Параметры**.
5. Выберите **Центр управления безопасностью**, а затем нажмите кнопку **Параметры центра управления безопасностью**.
6. Выберите пункт **Доверенные каталоги приложений**.
7. В поле **URL-адрес каталога** введите сетевой путь к общей папке, содержащей файл manifest-word-add-in-canvas.xml, а затем выберите элемент **Добавить каталог**.
8. Установите флажок **Показать в меню** и нажмите кнопку **ОК**.
9. Появится сообщение, информирующее о том, что параметры будут применены при следующем запуске Office. Закройте и перезапустите Word.

## Как запустить надстройку в Word 2016 для Windows

1. Откройте документ Word.
2. На вкладке **Вставка** в Word 2016 выберите **Мои приложения**.
3. Перейдите на вкладку **Общая папка**.
4. Выберите элемент **Надстройка с выносками изображений**, а затем нажмите кнопку **Вставить**.
5. Если ваша версия Word поддерживает команды надстроек, то в пользовательском интерфейсе отобразятся сведения о том, что надстройка загружена. С помощью вкладки **Надстройка с выносками** можно загрузить надстройку в пользовательском интерфейсе и вставить изображение в документ. Кроме того, вставить изображение в документ можно с помощью контекстного меню, вызываемого при нажатии правой кнопкой мыши.
6. Если ваша версия Word не поддерживает команды надстроек, то надстройка загрузится в области задач. Чтобы использовать функции надстройки, необходимо вставить изображение в документ Word.
7. Выберите изображение в документе Word и загрузите его в область задач, выбрав команду *Load image from doc* (Загрузить изображение из документа). Теперь в изображение можно вставлять выноски. Нажмите *Insert image into doc* (Вставить изображение в документ), чтобы поместить измененное изображение в документ Word. Надстройка создаст заполнитель описания для каждой выноски.

## Вопросы и ответы

* Будут ли команды надстроек работать на компьютерах Mac и устройствах iPad? Нет, на момент публикации этого руководства они не работают на Mac и iPad.
* Почему надстройка не отображается в окне **Мои надстройки**? Возможно, в манифесте надстройки допущена ошибка. Рекомендуем сравнить манифест со [схемой манифеста](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/tree/master/Tools/XSD).
* Почему не вызывается файл функций для команд надстройки? Команды надстроек используют протокол HTTPS. Так как для команд надстроек необходим протокол TLS и у них нет пользовательского интерфейса, невозможно проверить наличие проблем с сертификатом. Если необходимо принять недействительный сертификат в области задач, команда надстройки не будет работать.
* Почему команды установки npm зависают? Скорее всего, команда не зависла. Просто в Windows установка занимает много времени.

## Вопросы и комментарии

Мы будем рады получить от вас отзывы о примере надстройки Word с выносками изображений. Вы можете задать нам вопросы и добавлять предложения в разделе [Issues](https://github.com/OfficeDev/Word-Add-in-TypeScript-Canvas/issues)(Проблемы) этого репозитория.

Общие вопросы о разработке надстроек следует задавать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/Office365+API). Убедитесь, что ваши вопросы и комментарии помечены тегами [office-js], [word-addins] и [API]. Мы следим за этими тегами.

## Подробнее

Ниже представлены дополнительные ресурсы, посвященные созданию надстроек на основе API JavaScript для Word.

* [Обзор платформы надстроек Office](https://msdn.microsoft.com/ru-ru/library/office/jj220082.aspx)
* [Надстройки Word](https://github.com/OfficeDev/office-js-docs/blob/master/word/word-add-ins.md)
* [Общие сведения о создании надстроек Word](https://github.com/OfficeDev/office-js-docs/blob/master/word/word-add-ins-programming-guide.md)
* [Обозреватель фрагментов кода для Word](http://officesnippetexplorer.azurewebsites.net/#/snippets/word)
* [Справочник по API JavaScript для надстроек Word](https://github.com/OfficeDev/office-js-docs/tree/master/word/word-add-ins-javascript-reference)
* [Пример "SillyStories"](https://github.com/OfficeDev/Word-Add-in-SillyStories). Узнайте, как загружать DOCX-файлы из службы и вставлять их в открытый документ Word.
* [Пример надстройки Office с проверкой подлинности на сервере для Node.js](https://github.com/OfficeDev/Office-Add-in-Nodejs-ServerAuth). Узнайте, как использовать поставщиков Azure и Google OAuth для проверки подлинности пользователей.

## Авторское право
(c) Корпорация Майкрософт (Microsoft Corporation), 2016. Все права защищены.
